'use strict';var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),API=function(){function API(){_classCallCheck(this,API)}return _createClass(API,null,[{key:'request',value:function request(a,b,c,d,f){var _this2=this;$.ajax({url:'/api/'+b+'/'+c,method:a?'POST':'GET',data:d,success:function success(g){'null'===g.error?f(!0,null,g.warnings,g):f(!1,_this2.responsify(g.error),g.warnings,g)},error:function error(g){return f(!1,null,null,g)}})}},{key:'responsify',value:function responsify(a){var b=function b(c,d){return{type:c,text:d}};return{not_logged_in:b('error','Not logged in'),invalid_request:b('error','Invalid request'),video_not_found:b('error','Video not found. Perhaps it has already been deleted'),insufficient_permissions:b('error','Insufficient permissions'),no_tags_specified:b('info','No tags specified')}[a]}}]),API}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}var Video=function(){function Video(){_classCallCheck(this,Video);var a=location.href.match(/(\d+)(?!.*\/.)/);a&&(this.id=a[1],this.user=$('.fa-info-circle').next().children().text().trim(),this.tags=$.makeArray($('#tag-display').children().children()).map(function(b){return b.innerText}).filter(function(b){return!!b}),this.api='video',this.apiBase=this.api+'/'+this.id)}return _createClass(Video,[{key:'tag',value:function tag(a,b){var c=this;a.length?API.request(!0,this.apiBase,'tag',{tags:a},function(f,g,h,j){f&&(c.tags=[],c.tags=j.tags.map(function(k){return k.name})),b(f,g,h,j)}):b(!1,API.responsify('no_tags_specified'),null,null)}},{key:'untag',value:function untag(a,b){var c=this;a=a.trim(),a?API.request(!0,this.apiBase,'untag',{tag:a},function(f,g,h,j){f&&(c.tags=[],c.tags=j.tags.map(function(k){return k.name})),b(f,g,h,j)}):b(!1,API.responsify('invalid_request'),null,null)}},{key:'delete',value:function _delete(a,b){a=a.trim(),a?API.request(!0,this.apiBase,'delete',{reason:a},b):b(!1,API.responsify('invalid_request'),null,null)}}]),Video}();var video;$(function(){video=new Video,video.id||(video=null)}),$(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr('content')}})});function flash(a,b){var c=$('.flashcontainer > .container');'error'===a&&(a='danger'),c.append('<div class="alert alert-:TYPE: alert-dismissable" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>:REPLACE:</div>'.replace(/:TYPE:/,a).replace(/:REPLACE:/,b)),alertrm(jQuery)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}(),Array.prototype.average=function(){for(var a=0,b=0;b<this.length;b++)a+=this[b];return a/this.length};var videoElem=document.getElementById('video');if(null!==videoElem){var a=function a(){videoElem.paused||videoElem.ended||!background||(context.drawImage(videoElem,0,0,cw,ch),window.requestAnimFrame(a))},b=function b(){var d=$('#next');'hidden'!=d.css('visibility')&&d.get(0).click()},c=function c(){var d=$('#prev');'hidden'!=d.css('visibility')&&d.get(0).click()},player=videojs(videoElem,{controls:!0,playbackRates:[0.25,0.5,1,1.5,2],inactivityTimeout:850,controlBar:{children:{progressControl:{},playToggle:{},MuteToggle:{},volumeControl:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},CustomControlSpacer:{},playbackRateMenuButton:{},fullscreenToggle:{}}}},function(){this.addClass('video-js'),this.volume(0.3),this.muted(!1),'undefined'!=typeof localStorage&&(this.volume(Math.abs(localStorage.getItem('volume')||0.3)),this.muted(0>1/(localStorage.getItem('volume')||0.3)),this.on('volumechange',function(){localStorage.setItem('volume',this.volume()*(this.muted()?-1:1))}))});//Key Bindings
//player.on('mouseout', function(){ this.userActive(false) });
//videojs fix for firefox
-1!=navigator.userAgent.toLowerCase().indexOf('firefox')&&player.autoplay()&&!player.paused()&&player.hasClass('vjs-paused')&&(player.pause(),player.play()),localStorage.getItem('background')==void 0&&($.browser.mobile?localStorage.setItem('background','false'):localStorage.setItem('background','true'));var background='true'===localStorage.getItem('background'),canvas=document.getElementById('bg'),context=canvas.getContext('2d'),cw=canvas.width=0|canvas.clientWidth,ch=canvas.height=0|canvas.clientHeight;background||$(canvas).css('display','none'),videoElem.addEventListener('play',a),$('#togglebg').on('click',function(d){d.preventDefault(),background=!background,localStorage.setItem('background',background.toString()),background?$(canvas).css('display','block'):$(canvas).css('display','none'),a()}),$(document).on('keydown',function(d){d.defaultPrevented||d.target.nodeName.match(/\b(input|textarea)\b/i)||d.ctrlKey||d.altKey||d.shiftKey||(39==d.keyCode?b():37==d.keyCode?c():65==d.keyCode?c():68==d.keyCode?b():72==d.keyCode?c():76==d.keyCode?b():82==d.keyCode?$('#prev').next().get(0).click():70==d.keyCode?$('#fav').get(0).click():67==d.keyCode?$('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments):87==d.keyCode||38==d.keyCode?player.volume(player.volume()+0.1):83==d.keyCode||40==d.keyCode?player.volume(player.volume()-0.1):32==d.keyCode&&(player.paused()?player.play():player.pause()))}),$('.wrapper > div:not(.aside)').on('DOMMouseScroll mousewheel',function(d){d.ctrlKey||d.altKey||d.shiftKey||(d.preventDefault(),0>d.deltaY?b():c())})}else{var canvas=document.getElementById('bg');canvas.parentNode.removeChild(canvas)}function commentClickableTimestamp(a){if(a.preventDefault(),player){var b=$(a.target).text().match(/(\d{1,2}):(\d{2})/);if(b){var c=60*parseInt(b[1])+parseInt(b[2]);c<=player.duration()&&player.currentTime(c)}}}$(function(){$('.comment_clickable_timestamp').on('click',commentClickableTimestamp)}),function(a){function b(){var m=function m(n,o,q){return n.innerHTML=n.innerHTML.replace(o,q)};j.children().children(':first-of-type').each(function(n,o){m(o,/^nsfw$/i,function(q){return'<span style="color: red;">'+q+'</span>'}),m(o,/^sfw$/i,function(q){return'<span style="color: #23ff00;">'+q+'</span>'})})}function c(m){m.preventDefault(),confirm('Do you really want to delete this tag?')&&video.untag(a(this).siblings().text(),function(n,o,q,t){if(n){flash('success','Tag successfully deleted');var u=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=t.tags[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var w=_step.value;u.push('<span class="label label-default"><a href="/index?q='+w.normalized+'" class="default-link">'+w.name+'</a> <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a></span>')}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}j.empty(),j.append(u.join(' ')),a('.delete-tag').on('click',c),b()}else flash('error','Error deleting tag')})}// Comments
var d=a('#commentForm > form'),f='';d.on('submit',function(m){m.preventDefault();// double comment prevention:
var n=d.serialize();return n==f?(alert('nope. just don\'t. seriously... don\'t.'),!1):void(f=n,a.ajax({type:'POST',url:d.attr('action'),data:n}).done(function(o){a('.nocomments').remove();var q=a(o).appendTo('.commentwrapper').find('time.timeago');q.timeago(),q.tooltip(),q.closest('.panel-footer').siblings('.panel-body').find('.comment_clickable_timestamp').on('click',commentClickableTimestamp);var t=d.find('textarea').val('');t.blur()}).fail(function(){flash('error','Error saving comment')}))});//Tags
var g=a('#tags'),h=a('#submittags'),j=a('#tag-display');b(),a('.delete-tag').on('click',c),a('#tags, #filter').on('itemAdded',function(m){return setTimeout(function(){return a(m.currentTarget).siblings('.bootstrap-tagsinput').children('input').val('')},0)}),g.on('beforeItemAdd',function(m){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=video.tags[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var n=_step2.value;n.toLowerCase()===m.item.toLowerCase()&&(m.cancel=!0,flash('info','Tag already exists'))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}),h.on('click touchdown',function(m){m.preventDefault(),video.tag(g.tagsinput('items'),function(n,o,q,t){if(n){a('#tag-add-toggle').prop('checked',!1);var u=[];var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=t.tags[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var w=_step3.value;u.push('<span class="label label-default"><a href="/index?q='+w.normalized+'" class="default-link">'+w.name+'</a>'+(t.can_edit_video?' <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a>':'')+'</span>')}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}j.empty(),j.append(u.join(' ')),g.tagsinput('removeAll'),a('.delete-tag').on('click',c),b()}else flash('error','Error saving tag(s)')})});// Filter
var k=a('#filter'),l=a('#submitfilter');l.on('click touchdown',function(m){m.preventDefault(),a.ajax({type:'POST',url:l.attr('href'),data:k.serialize()}).done(function(){flash('success','Filter successfully updated'),a('#filterselectmodal').modal('hide')}).fail(function(n){flash('error','Error updating filter')})})}(jQuery),function(a){function b(f,g){if(a('video').length){var h=[];g.interpret&&h.push(' <strong>Artist:</strong> '+g.interpret),g.songtitle&&h.push(' <strong>Songtitle:</strong> '+g.songtitle),g.imgsource&&h.push(' <strong>Video Source:</strong> '+g.imgsource),g.category.name&&h.push(' <strong>Category:</strong> '+g.category.name),a('span.fa-info-circle').attr('data-content',h.join('<br>'))}else{var j=f.parents('tr');j.find('span').show(),j.find('input, select').hide(),j.find('.vinterpret').html(g.interpret),j.find('.vsongtitle').html(g.songtitle),j.find('.vimgsource').html(g.imgsource),j.find('.vcategory').html('<a href="/'+g.category.shortname+'">'+g.category.name+'</a>')}}var c=a('.indexform, #webmedit');if(a('.indexedit').find('input, select').hide(),c.length){var d=a('tr');d.on('dblclick touchdown',function(f){var g=a(this);g.find('input, select').show(),g.find('span').hide()})}c.on('submit',function(f){var g=a(this);f.preventDefault(),a.ajax({type:'POST',url:g.attr('action'),data:g.serialize()}).done(function(h){flash('success','Video successfully updated'),b(g,h),g.find('#webmeditmodal').modal('hide')}).fail(function(){flash('error','Error updating video'),g.find('#webmeditmodal').modal('hide')})})}(jQuery),function(a){var b=a('#fav');b.on('click touchdown',function(c){c.preventDefault(),a.ajax({type:'GET',url:b.attr('href')}).done(function(){var d=b.find('i');d.hasClass('fa-heart-o')?(d.removeClass('fa-heart-o'),d.addClass('fa-heart')):(d.removeClass('fa-heart'),d.addClass('fa-heart-o'))})})}(jQuery),function(a){a('#togglebg').on('click touchdown',function(b){b.preventDefault(),a.ajax({dataType:'json',url:a(this).attr('href'),data:{}}).done(function(){a('#bg').toggle()})})}(jQuery),function(a){a(':not(form)[data-confirm]').on('click touchdown',function(){return confirm(a(this).data('confirm'))})}(jQuery),function(a){a('.commentwrapper, .tags').mCustomScrollbar({axis:'y',theme:'minimal',scrollInertia:0})}(jQuery);var alertrm=function alertrm(a){a('.alert').each(function(b){a(this).delay(3000+1000*b).slideUp(300,function(){a(this).remove()})})};alertrm(jQuery),$('#categories').imagesLoaded(function(){$('#categories').isotope({itemSelector:'.category',percentPosition:!0,layoutMode:'masonry'})}),$(function(){$('[data-toggle="popover"]').popover({html:!0,trigger:'manual',container:$(this).attr('id'),placement:'top'}).on('mouseenter',function(){var a=this;$(this).popover('show'),$(this).siblings('.popover').on('mouseleave',function(){$(a).popover('hide')})}).on('mouseleave',function(){var a=this;setTimeout(function(){$('.popover:hover').length||$(a).popover('hide')},100)})}),function(){var a=document.getElementById('video');if(null!=a){var b=a.parentNode;b.style.marginBottom='3px';var c=document.createElement('div'),d=document.createElement('div');d.appendChild(c),b.appendChild(d),$(d).css({height:'3px',width:'100%',overflow:'hidden',willChange:'transform',position:'absolute',bottom:'0'}),$(c).css({height:'inherit',width:'inherit',position:'absolute',transform:'translateX(-100%)',backgroundColor:'rgba(31, 178, 176, 0.4)'});var f=function f(){if(requestAnimationFrame(f),!a.paused){var t=100/a.duration*a.currentTime;c.style.transform='translateX('+(-100+t)+'%)'}};f()}}(),function(a){var b=localStorage.comments;b===void 0&&(localStorage.comments=!0),b=b===void 0||'true'===b,a('.aside').toggle(b),a('#toggle').click(function(){a('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments)})}(jQuery),$(function(){function a(b){return[b.clientX+$('div#thumb').width()>=$(window).width()-10?b.pageX-5-$('div#thumb').width():b.pageX+5,b.clientY+$('div#thumb').height()>=$(window).height()-10?b.pageY-5-$('div#thumb').height():b.pageY+5]}$('[data-thumb]').on('mouseenter',function(b){var c=$(this).data('thumb'),d=a(b);$(document.body).prepend('<div id="thumb"></div>'),$('div#thumb').prepend('<img id="thumb"/>'),$('img#thumb').text('Loading...'),$('div#thumb').css({position:'absolute',left:d[0],top:d[1],"z-index":'5',border:'1px white solid',"box-shadow":'5px 5px 7px 0px rgba(0,0,0,0.75)',color:'white',"background-color":'#181818'});var f=$('img#thumb'),g=$('<img/>');g.load(function(){f.attr('src',$(this).attr('src')),d=a(b),$('div#thumb').css({left:d[0],top:d[1]})}),g.attr('src','/thumbs/'+c+'.gif')}).on('mousemove',function(b){$('div#thumb').css({left:a(b)[0],top:a(b)[1]})}).on('mouseleave',function(){$('#thumb').remove()})});//Pagination
var paginate=function paginate(a,b){var c=b.hash.type||'middle',d='',f=+a.pageCount,g=+a.page,h;b.hash.limit&&(h=+b.hash.limit);//page pageCount
var j={};switch(c){case'middle':if('number'==typeof h){var k=0,l=Math.ceil(h/2)-1,m=h-l-1;g+m>f&&(l=h-(f-g)-1),1>g-l&&(l=g-1);for(var n=g-l;k<h&&k<f;)j={n:n},n==g&&(j.active=!0),d=d+b.fn(j),n++,k++}else for(var k=1;k<=f;k++)j={n:k},k===g&&(j.active=!0),d=d+b.fn(j);break;case'previous':j=1==g?{disabled:!0,n:1}:{n:g-1},d=d+b.fn(j);break;case'next':j={},j=g==f?{disabled:!0,n:f}:{n:g+1},d=d+b.fn(j);break;case'first':j=1==g?{disabled:!0,n:1}:{n:1},d=d+b.fn(j);break;case'last':j=g==f?{disabled:!0,n:f}:{n:f},d=d+b.fn(j);}return d};//enable bootstrap tooltips and timeago
$(function(){var a=$.timeago.settings,b=a.strings;a.refreshMillis=1000,a.allowFuture=!0,a.localeTitle=!0,b.seconds='%d seconds',b.minute='1 minute',b.hour='1 hour',b.hours='%d hours',b.day='1 day',b.month='1 month',b.year='1 year',b.suffixFromNow=null,$('time.timeago').timeago(),$('[data-toggle="tooltip"]').tooltip()});// Notifications
var messagesBadge=$('ul.navbar-right > li > a > span.badge'),activeMessage;0<messagesBadge.text()&&messagesBadge.css('visibility','visible'),/\/user\/.+\/comments/i.test(location.href)?function(a){if('undefined'!=typeof Handlebars){Handlebars.registerHelper('paginate',paginate);var b=Handlebars.compile(a('#comlist').html()),c=Handlebars.compile(a('#paginationtmpl').html()),d=location.href.match(/\/user\/(.+)\/comments/i)[1],f=function f(g){var h='/api/comments';g||(g=h),a.getJSON(g,{username:d}).done(function(j){a('.spinner').hide(),a('#list').html(b(j)),a('time.timeago').timeago(),a('time[data-toggle="tooltip"]').tooltip();var k={pagination:{page:j.current_page,pageCount:j.last_page}};a('#pagination').html(c(k)),a('#pagination a').on('click touchdown',function(l){l.preventDefault(),f(h+'?page='+a(this).data('page'))})})};f()}// only on profilelayout
}(jQuery):function(a){if('undefined'!=typeof Handlebars&&a('#msglist').length){Handlebars.registerHelper('paginate',paginate);var b=Handlebars.compile(a('#msglist').html()),c=Handlebars.compile(a('#msgtmpl').html()),d=Handlebars.compile(a('#paginationtmpl').html()),f={},g=function g(h){var j='/api/messages';h||(h=j),a.getJSON(h).done(function(k){a('.spinner').hide(),f=k,a('#list').html(b(k)),'undefined'!=typeof activeMessage&&a('#listitems a[data-id="'+activeMessage+'"]').addClass('active');var l={pagination:{page:k.current_page,pageCount:k.last_page}};a('#pagination').html(d(l)),a('#pagination a').on('click touchdown',function(m){m.preventDefault(),g(j+'?page='+a(this).data('page'))}),a('#listitems a').on('click touchdown',function(m){m.preventDefault();var n=a(this),o=n.data('index');activeMessage=a(this).data('id'),a('#message').html(c(f.data[o])),f.data[o].read||a.post('/api/messages/read','m_ids[]='+n.data('id')).done(function(q){n.removeClass('list-group-item-info'),messagesBadge.text(messagesBadge.text()-1),0>=messagesBadge.text()&&messagesBadge.css('visibility','hidden')}),a('a').removeClass('active'),n.addClass('active'),a('time.timeago').timeago(),a('time[data-toggle="tooltip"]').tooltip()})})};g()}// only on profilelayout
}(jQuery);function readAll(){$.ajax({url:'/api/messages/readall',success:function success(a){1==a?(flash('success','Marked all messages as read'),$('.list-group-item-info').removeClass('list-group-item-info'),messagesBadge.text('0'),messagesBadge.css('visibility','hidden')):flash('error','Failed to mark all messages as read')},error:function error(a,b,c){flash('error','Failed to mark all messages as read')}})}$('ul.dropdown-menu').on('click touchdown',function(a){a.stopPropagation()});function deleteComment(a){var b=a.closest('div[data-id]'),c=b.data('id'),d=$(b.children('.panel-footer').children('a')[0]).text();do{var f=prompt('Reason for deleting comment '+c+' by '+d);if(null===f)return;f=f.trim()}while(!f);$.ajax({url:'/api/comments/'+c+'/delete',method:'POST',data:{reason:f},success:function success(g){'success'==g?(flash('success','Comment deleted'),b.removeClass('panel-default').addClass('panel-danger'),b.find('.panel-footer').children('a[onclick="deleteComment($(this))"]').replaceWith('<a href="#" onclick="restoreComment($(this))"><i style="color:green"; class="fa fa-refresh" aria-hidden="true"></i></a>'),b.find('.panel-footer > a[onclick="editComment($(this))"]').remove()):'invalid_request'==g?flash('error','Invalid request'):'not_logged_in'==g?flash('error','Not logged in'):'insufficient_permissions'==g?flash('error','Insufficient permissions'):flash('error','Error deleting comment')},error:function error(g,h,j){flash('error','Error deleting comment')}})}function restoreComment(a){var b=a.closest('div[data-id]'),c=b.data('id'),d=$(b.children('.panel-footer').children('a')[0]).text();do{var f=prompt('Reason for restoring comment '+c+' by '+d);if(null===f)return;f=f.trim()}while(!f);$.ajax({url:'/api/comments/'+c+'/restore',method:'POST',data:{reason:f},success:function success(g){'success'==g?(flash('success','Comment restored'),b.removeClass('panel-danger').addClass('panel-default'),b.find('.panel-footer').children('a[onclick]').replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')):'invalid_request'==g?flash('error','Invalid request'):'not_logged_in'==g?flash('error','Not logged in'):'insufficient_permissions'==g?flash('error','Insufficient permissions'):'comment_not_deleted'==g?flash('error','Comment is not deleted'):flash('error','Error restoring comment')},error:function error(g,h,j){flash('error','Error restoring comment')}})}function editComment(a){var b=a.closest('div[data-id]'),c=b.find('.panel-body'),d=b.data('id');$.ajax({url:'/api/comments/'+d,success:function success(f){if('null'==f.error){var g=$('<textarea class="form-control">');c.replaceWith(g),g.val($('<div>').html(f.comment).text()),a.prev().remove(),a.replaceWith('<a href="#" class="saveCommentEdit"><i class="fa fa-floppy-o" aria-hidden="true"></i></a> <a href="#" class="abortCommentEdit"><i style="color:red;" class="fa fa-ban" aria-hidden="true"></i></a>'),b.find('.abortCommentEdit').on('click',function(h){h.preventDefault(),$(this).prev().remove(),$(this).replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>'),g.replaceWith(c)}),b.find('.saveCommentEdit').on('click',function(h){h.preventDefault();var j=$(this);$.ajax({url:'/api/comments/'+d+'/edit',method:'POST',data:{comment:g.val()},success:function success(k){'null'==k.error?(c.html(k.rendered_comment),flash('success','Comment edited successfully'),c.find('.comment_clickable_timestamp').on('click',commentClickableTimestamp)):'invalid_request'==k.error?flash('error','Invalid request was sent by your browser'):'not_logged_in'==k.error?flash('error','Not logged in'):'insufficient_permissions'==k.error?flash('error','Insufficient permissions'):'comment_not_found'==k.error?flash('error','Comment does not exist'):flash('error','Error editing comment')},error:function error(k,l,m){flash('error','Error editing comment')},complete:function complete(){g.replaceWith(c),j.next().remove(),j.replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')}})})}else'comment_not_found'==f.error?flash('error','Comment does not exist'):flash('error','Error editing comment')},error:function error(f,g,h){flash('error','Failed receiving non-rendered comment from API')}})}/*$(function () {
    var cBar = $('.vjs-control-bar');
    var cBarStatus = false;
    $('video').on('mousemove', function () {
        if(cBarStatus) return;
        cBar.css('display', 'flex');
        cBarStatus = true;
    }).on('mouseleave', function (e) {
        if($(e.relatedTarget).is('[class^="vjs"]') || !cBarStatus) return;
        cBar.hide();
        cBarStatus = false;
    });
    $('[class^="vjs"]').on('mouseleave', function (e) {
        if(e.relatedTarget == $('video').get(0) || $(e.relatedTarget).is('[class^="vjs"]') || !cBarStatus) return;
        cBar.hide();
        cBarStatus = false;
    });
});*///upload
$(function(){if(/\/upload/.test(location.href)){var P=function P(){$('#dragndrop').css({color:k,"border-color":l,"background-color":m})},Q=function Q(W){var X=Math.floor(Math.log(W)/Math.log(1024));return(W/Math.pow(1024,X)).toFixed(2)+' '+['B','kB','MB','GB','TB','PB','EB','ZB','YB'][X]},R=function R(W){W.preventDefault(),$('input[type="file"]').trigger('click')},S=function S(){$('#dragndrop-link').on('click',R),$('#dragndrop-link').attr('href','#'),$('#dragndrop-text').html(j)},T=function T(W){$('#dragndrop-link').removeAttr('href').off('click'),$('#dragndrop-text').html('<video id="video_preview" src="'+URL.createObjectURL(W)+'" autoplay controls loop></video><span class="upload-info">'+W.name+' &mdash; '+Q(W.size)+' &mdash; <a id="dragndrop-clear" class="fa fa-times" href="#"></a></span><div class="progress progress-striped" style="display: none; margin-left: 10px; margin-right: 10px;"><div class="progress-bar progress-bar-custom" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><span class="upload-info sr-only">0%</span></div></div><span class="upload-info"><span id="upload-stats" style="display: none;"></span></span>'),$('#video_preview').prop('volume',0),$('#dragndrop-clear').on('click',function(X){X.preventDefault(),X.stopPropagation(),o=null,$(this).off('click'),P(),S(),q&&'abort'!=q.statusText&&(q.abort(),q=null)})},U=function U(W){var X=1e8,Y=W.size>X,Z='video/webm'!==W.type;return Y&&$('#dragndrop').data('uploadlimit')||Z?(flash('error',Z?'Invalid file':'File too big. Max '+Q(X)),P(),!1):!0},V=function V(W,X,Y,Z,_,aa){function ba(){var ha=0,ia=da.length,ja;for(ja=ea;ja<ia;ja++)ha+=da[ja];ha=ha/(ja-ea),ea=ja,$('#upload-stats').text('Speed: '+Q(Math.floor(ha))+'/s Uploaded: '+Q(ca.loaded))}var ca={loaded:0,secondsElapsed:0},da=[],ea=0,fa,ga=new FormData;ga.append('interpret',W),ga.append('songtitle',X),ga.append('imgsource',Y),ga.append('category',Z),ga.append('tags',_),ga.append('file',aa),$('.progress-striped, #upload-stats').css('opacity',0).slideDown('fast').animate({opacity:1},{queue:!1,duration:'fast'}),q=$.ajax({url:'/api/upload',type:'POST',data:ga,processData:!1,contentType:!1,success:function success(ha){switch(ha.error){case'null':ha.video_id?(flash('success','Upload successful: <a href="/'+ha.video_id+'">/'+ha.video_id+'</a>. Redirect in 3 seconds...'),setTimeout(function(){location.href='/'+ha.video_id},3000)):flash('error','Upload failed');break;case'invalid_request':flash('error','Invalid request');break;case'not_logged_in':flash('error','Not logged in');break;case'uploadlimit_reached':flash('error','Uploadlimit reached');break;case'invalid_file':flash('error','Invalid file');break;case'file_too_big':flash('error','File too big. Max 30MB');break;case'already_exists':ha.video_id?flash('error','Video already exists: <a href="/'+ha.video_id+'">/'+ha.video_id+'</a>'):flash('error','Video already existed but has been deleted');break;case'erroneous_file_encoding':flash('error','Erroneous file encoding. <a href="/webm">Try reencoding it</a>');break;default:flash('error','Upload failed');}'null'!=ha.error&&($('.progress-bar-custom').css('background-color','red'),$('.progress-bar-custom').text('Upload failed')),$('#upload-stats').text('Speed: '+Q(Math.floor(da.average()))+'/s Uploaded: '+Q(o.size))},error:function error(ha,ia,ja){return ha=null,'abort'==ja?void flash('info','Upload aborted'):void(flash('error','Upload failed'),$('.progress-bar-custom').css('background-color','red'),$('.progress-bar-custom').text('Upload failed'))},complete:function complete(){clearInterval(fa)},xhr:function xhr(){var ha=$.ajaxSettings.xhr(),ia=new Date;return $('.progress-bar-custom').css('background-color','rgba(47, 196, 47, 1)'),ha.upload.onprogress=function(ja){var ka=Math.floor(100*(ja.loaded/ja.total)),la=(new Date().getTime()-ia.getTime())/1000,ma=(ja.loaded-ca.loaded)/(la-ca.secondsElapsed);$('.progress-bar-custom').css('width',ka+'%'),$('.progress-bar-custom').text(ka+'%'),ca.secondsElapsed=la,ca.loaded=ja.loaded,da.push(ma),fa||(ba(),fa=setInterval(ba,500))},ha}})},j=$('#dragndrop-text').html(),k=$('#dragndrop').css('color'),l=$('#dragndrop').css('border-left-color'),m=$('#dragndrop').css('background-color'),n=0,o=void 0,q=void 0,t=$('#tags_upload'),u=$('#nsfw');$('input[type="file"]').on('change',function(W){if(this.files.length){var X=this.files[0];U(X)&&(o=X,T(X)),$(this).wrap('<form>').closest('form').get(0).reset(),$(this).unwrap()}}),$('#dragndrop-link').on('click',R),$(document).on('dragenter',function(W){W.preventDefault(),n++;var X=W.originalEvent.dataTransfer;null!=X.types&&(X.types.indexOf?0===X.types.indexOf('Files'):X.types.contains('application/x-moz-file'))&&$('#dragndrop').css({color:'#BBB',"border-color":'#656464',"background-color":'#323234'})}).on('dragleave',function(){n--,0==n&&P()}).on('dragover',function(W){W.preventDefault()}).on('drop',function(W){W.preventDefault(),$(W.target).is('#dragndrop-text')||P()}),$('#dragndrop-text').on('dragover',function(W){var X=W.originalEvent.dataTransfer,Y=X.effectAllowed;X.dropEffect='move'===Y||'linkMove'===Y?'move':'copy'}).on('drop',function(W){if(W.originalEvent.dataTransfer.files.length){q&&'abort'!=q.statusText&&(q.abort(),o=null,S());var X=W.originalEvent.dataTransfer.files[0];P(),U(X)&&(o=X,T(X),n=0)}}),$('button#btn-upload').on('click',function(){return o?q&&(0==q.readyState||1==q.readyState||3==q.readyState)?void flash('info','Already uploading'):void V($('#interpret').val(),$('#songtitle').val(),$('#imgsource').val(),$('#category').val(),t.tagsinput('items'),o):void flash('error','No file selected')}),t.on('itemRemoved',function(W){'nsfw'===W.item?(u.prop('checked',!1),$(this).tagsinput('add','sfw')):'sfw'===W.item&&(u.prop('checked',!0),$(this).tagsinput('add','nsfw'))}),u.on('change',function(){this.checked?(t.tagsinput('remove','sfw'),t.tagsinput('add','nsfw')):(t.tagsinput('remove','nsfw'),t.tagsinput('add','sfw'))}),u.trigger('change')}}),$(function(){$('#delete_video').on('click',function(a){a.preventDefault();do{var b=prompt('Reason for deleting video '+video.id+' by '+video.user);if(null===b)return;b=b.trim()}while(!b);video.delete(b,function(c,d,f){if(c){flash('success','Video deleted. Redirect in 3 seconds...'),setTimeout(function(){return location.href='/'},3000);var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=f[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var g=_step4.value;flash('warning',g)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}else flash('error','Error deleting video')})})});
